---
title: "Self-Hosting & Deployment"
description: "Complete guide to deploying Honcho in production environments"
---

# Self-Hosting & Deployment

This guide covers deploying Honcho in production environments, from simple single-server setups to scalable cloud deployments.

## Overview

Honcho can be deployed in various configurations depending on your needs:

- **Single Server**: Simple deployment for small to medium workloads
- **Containerized**: Docker-based deployment with orchestration
- **Cloud Native**: Kubernetes deployment with auto-scaling
- **Serverless**: Function-based deployment for specific use cases

## Prerequisites

### System Requirements

**Minimum Requirements:**
- 2 CPU cores
- 4GB RAM
- 20GB storage
- PostgreSQL 15+ with pgvector extension
- Internet connectivity for AI services

**Recommended for Production:**
- 4+ CPU cores
- 8GB+ RAM
- 100GB+ SSD storage
- Load balancer
- Monitoring stack

### Dependencies

**Required Services:**
- PostgreSQL 15+ with pgvector
- Redis (optional but recommended for caching)
- OpenAI API access (or alternative AI provider)

**Optional Services:**
- NGINX (reverse proxy and load balancing)
- Sentry (error tracking)
- Prometheus + Grafana (monitoring)

## Docker Deployment

### Single Container Setup

**Basic Deployment:**
```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    image: plastic-labs/honcho:latest
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://honcho:password@database:5432/honcho
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - database
      - redis
    restart: unless-stopped

  database:
    image: pgvector/pgvector:pg15
    environment:
      - POSTGRES_DB=honcho
      - POSTGRES_USER=honcho
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    restart: unless-stopped

  deriver:
    image: plastic-labs/honcho:latest
    command: python -m src.deriver
    environment:
      - DATABASE_URL=postgresql://honcho:password@database:5432/honcho
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - database
      - redis
    restart: unless-stopped
    deploy:
      replicas: 2

volumes:
  postgres_data:
  redis_data:
```

**Environment Configuration:**
```bash
# .env
OPENAI_API_KEY=sk-your-openai-api-key
JWT_SECRET=your-super-secret-jwt-key
POSTGRES_PASSWORD=secure-database-password
REDIS_PASSWORD=secure-redis-password
```

**Deployment Commands:**
```bash
# Clone repository
git clone https://github.com/plastic-labs/honcho.git
cd honcho

# Configure environment
cp .env.example .env
# Edit .env with your configuration

# Start services
docker-compose up -d

# Check status
docker-compose ps

# View logs
docker-compose logs -f app
```

### Production Docker Setup

**Multi-Stage Dockerfile:**
```dockerfile
# Dockerfile.production
FROM python:3.11-slim as builder

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

FROM python:3.11-slim as runtime

RUN useradd --create-home --shell /bin/bash honcho
WORKDIR /home/honcho

# Copy dependencies from builder
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages
COPY --from=builder /usr/local/bin /usr/local/bin

# Copy application code
COPY --chown=honcho:honcho . .

USER honcho
EXPOSE 8000

# Health check
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8000/health || exit 1

CMD ["uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**Production Compose:**
```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app
    restart: unless-stopped

  app:
    build:
      context: .
      dockerfile: Dockerfile.production
    environment:
      - DATABASE_URL=postgresql://honcho:${POSTGRES_PASSWORD}@database:5432/honcho
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - JWT_SECRET=${JWT_SECRET}
      - REDIS_URL=redis://redis:6379/0
      - USE_AUTH=true
      - LOG_LEVEL=INFO
    depends_on:
      - database
      - redis
    restart: unless-stopped
    deploy:
      replicas: 3
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  database:
    image: pgvector/pgvector:pg15
    environment:
      - POSTGRES_DB=honcho
      - POSTGRES_USER=honcho
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backups:/backups
    restart: unless-stopped
    command: >
      postgres
      -c shared_preload_libraries=vector
      -c max_connections=200
      -c shared_buffers=256MB
      -c effective_cache_size=1GB

  redis:
    image: redis:7-alpine
    command: redis-server --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data
    restart: unless-stopped

  deriver:
    build:
      context: .
      dockerfile: Dockerfile.production
    command: python -m src.deriver
    environment:
      - DATABASE_URL=postgresql://honcho:${POSTGRES_PASSWORD}@database:5432/honcho
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
    depends_on:
      - database
      - redis
    restart: unless-stopped
    deploy:
      replicas: 3

volumes:
  postgres_data:
  redis_data:
```

### NGINX Configuration

**Reverse Proxy Setup:**
```nginx
# nginx.conf
events {
    worker_connections 1024;
}

http {
    upstream honcho_backend {
        server app:8000;
    }

    server {
        listen 80;
        server_name your-domain.com;
        return 301 https://$server_name$request_uri;
    }

    server {
        listen 443 ssl http2;
        server_name your-domain.com;

        ssl_certificate /etc/nginx/ssl/cert.pem;
        ssl_certificate_key /etc/nginx/ssl/key.pem;
        ssl_protocols TLSv1.2 TLSv1.3;

        # Security headers
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";

        # Rate limiting
        limit_req_zone $binary_remote_addr zone=api:10m rate=30r/m;

        location / {
            limit_req zone=api burst=10;
            
            proxy_pass http://honcho_backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            proxy_connect_timeout 60s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }

        location /health {
            access_log off;
            proxy_pass http://honcho_backend;
        }
    }
}
```

## Kubernetes Deployment

### Namespace and Secrets

**Create Namespace:**
```yaml
# namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: honcho
```

**Secrets Configuration:**
```yaml
# secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: honcho-secrets
  namespace: honcho
type: Opaque
stringData:
  database-url: "postgresql://honcho:password@postgres:5432/honcho"
  openai-api-key: "sk-your-openai-api-key"
  jwt-secret: "your-super-secret-jwt-key"
  redis-password: "secure-redis-password"
```

### Database Deployment

**PostgreSQL with pgvector:**
```yaml
# postgres.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres
  namespace: honcho
spec:
  serviceName: postgres
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
      - name: postgres
        image: pgvector/pgvector:pg15
        env:
        - name: POSTGRES_DB
          value: honcho
        - name: POSTGRES_USER
          value: honcho
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: honcho-secrets
              key: database-password
        ports:
        - containerPort: 5432
        volumeMounts:
        - name: postgres-storage
          mountPath: /var/lib/postgresql/data
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
  volumeClaimTemplates:
  - metadata:
      name: postgres-storage
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 100Gi

---
apiVersion: v1
kind: Service
metadata:
  name: postgres
  namespace: honcho
spec:
  ports:
  - port: 5432
  clusterIP: None
  selector:
    app: postgres
```

### Application Deployment

**Honcho API Deployment:**
```yaml
# honcho-api.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: honcho-api
  namespace: honcho
spec:
  replicas: 3
  selector:
    matchLabels:
      app: honcho-api
  template:
    metadata:
      labels:
        app: honcho-api
    spec:
      containers:
      - name: honcho-api
        image: plastic-labs/honcho:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: honcho-secrets
              key: database-url
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: honcho-secrets
              key: openai-api-key
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: honcho-secrets
              key: jwt-secret
        - name: USE_AUTH
          value: "true"
        - name: LOG_LEVEL
          value: "INFO"
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: honcho-api
  namespace: honcho
spec:
  selector:
    app: honcho-api
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: ClusterIP
```

**Deriver Workers:**
```yaml
# deriver.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: honcho-deriver
  namespace: honcho
spec:
  replicas: 3
  selector:
    matchLabels:
      app: honcho-deriver
  template:
    metadata:
      labels:
        app: honcho-deriver
    spec:
      containers:
      - name: honcho-deriver
        image: plastic-labs/honcho:latest
        command: ["python", "-m", "src.deriver"]
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: honcho-secrets
              key: database-url
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: honcho-secrets
              key: openai-api-key
        - name: REDIS_URL
          value: "redis://redis:6379/0"
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
```

### Ingress Configuration

**NGINX Ingress:**
```yaml
# ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: honcho-ingress
  namespace: honcho
  annotations:
    nginx.ingress.kubernetes.io/rate-limit: "30"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - api.yourdomain.com
    secretName: honcho-tls
  rules:
  - host: api.yourdomain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: honcho-api
            port:
              number: 80
```

### Helm Chart

**Chart.yaml:**
```yaml
apiVersion: v2
name: honcho
description: A Helm chart for Honcho
type: application
version: 0.1.0
appVersion: "0.0.15"
```

**values.yaml:**
```yaml
# Default values for honcho
replicaCount: 3

image:
  repository: plastic-labs/honcho
  pullPolicy: IfNotPresent
  tag: "latest"

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: api.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: honcho-tls
      hosts:
        - api.yourdomain.com

resources:
  limits:
    cpu: 500m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 512Mi

postgresql:
  enabled: true
  auth:
    postgresPassword: "secure-password"
    database: honcho
  image:
    repository: pgvector/pgvector
    tag: pg15

redis:
  enabled: true
  auth:
    enabled: true
    password: "redis-password"

deriver:
  enabled: true
  replicaCount: 2
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
```

## Cloud Provider Deployments

### AWS Deployment

**ECS with Fargate:**
```yaml
# ecs-task-definition.json
{
  "family": "honcho",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "1024",
  "memory": "2048",
  "executionRoleArn": "arn:aws:iam::account:role/ecsTaskExecutionRole",
  "containerDefinitions": [
    {
      "name": "honcho-api",
      "image": "plastic-labs/honcho:latest",
      "portMappings": [
        {
          "containerPort": 8000,
          "protocol": "tcp"
        }
      ],
      "environment": [
        {
          "name": "USE_AUTH",
          "value": "true"
        }
      ],
      "secrets": [
        {
          "name": "DATABASE_URL",
          "valueFrom": "arn:aws:secretsmanager:region:account:secret:honcho/database-url"
        },
        {
          "name": "OPENAI_API_KEY",
          "valueFrom": "arn:aws:secretsmanager:region:account:secret:honcho/openai-key"
        }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/honcho",
          "awslogs-region": "us-west-2",
          "awslogs-stream-prefix": "ecs"
        }
      }
    }
  ]
}
```

**RDS Configuration:**
```bash
# Create RDS instance with pgvector
aws rds create-db-instance \
  --db-instance-identifier honcho-db \
  --db-instance-class db.t3.medium \
  --engine postgres \
  --engine-version 15.4 \
  --master-username honcho \
  --master-user-password secure-password \
  --allocated-storage 100 \
  --vpc-security-group-ids sg-12345678 \
  --db-subnet-group-name honcho-subnet-group

# Enable pgvector extension
psql -h honcho-db.region.rds.amazonaws.com -U honcho -d honcho -c "CREATE EXTENSION vector;"
```

### Google Cloud Platform

**Cloud Run Deployment:**
```yaml
# cloudrun.yaml
apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: honcho-api
  annotations:
    run.googleapis.com/ingress: all
    run.googleapis.com/execution-environment: gen2
spec:
  template:
    metadata:
      annotations:
        run.googleapis.com/cpu-throttling: "false"
        run.googleapis.com/memory: "2Gi"
        run.googleapis.com/cpu: "2"
    spec:
      containerConcurrency: 100
      containers:
      - image: gcr.io/project-id/honcho:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: honcho-secrets
              key: database-url
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: honcho-secrets
              key: openai-api-key
        resources:
          limits:
            memory: "2Gi"
            cpu: "2"
```

**Cloud SQL Setup:**
```bash
# Create Cloud SQL instance
gcloud sql instances create honcho-db \
  --database-version=POSTGRES_15 \
  --tier=db-standard-2 \
  --region=us-central1

# Create database
gcloud sql databases create honcho --instance=honcho-db

# Enable pgvector
gcloud sql connect honcho-db --user=postgres
postgres=> CREATE EXTENSION vector;
```

### Azure Deployment

**Container Instances:**
```yaml
# azure-container-group.yaml
apiVersion: 2021-07-01
location: eastus
name: honcho-container-group
properties:
  containers:
  - name: honcho-api
    properties:
      image: plasticlabs/honcho:latest
      ports:
      - port: 8000
        protocol: TCP
      environmentVariables:
      - name: USE_AUTH
        value: true
      - name: DATABASE_URL
        secureValue: postgresql://user:pass@server/db
      - name: OPENAI_API_KEY
        secureValue: sk-your-api-key
      resources:
        requests:
          memoryInGB: 2
          cpu: 1
  ipAddress:
    type: Public
    ports:
    - protocol: TCP
      port: 8000
  osType: Linux
  restartPolicy: Always
type: Microsoft.ContainerInstance/containerGroups
```

## Monitoring and Maintenance

### Health Monitoring

**Health Check Script:**
```bash
#!/bin/bash
# health-check.sh

API_URL="https://api.yourdomain.com"
HEALTH_ENDPOINT="$API_URL/health"

# Check API health
response=$(curl -s -o /dev/null -w "%{http_code}" $HEALTH_ENDPOINT)

if [ $response -eq 200 ]; then
  echo "✅ API is healthy"
else
  echo "❌ API health check failed (HTTP $response)"
  exit 1
fi

# Check database connectivity
response=$(curl -s "$API_URL/health/detailed")
db_status=$(echo $response | jq -r '.database.status')

if [ "$db_status" = "healthy" ]; then
  echo "✅ Database is healthy"
else
  echo "❌ Database health check failed"
  exit 1
fi

echo "✅ All systems healthy"
```

### Backup Strategy

**Database Backups:**
```bash
#!/bin/bash
# backup.sh

DB_HOST="your-db-host"
DB_NAME="honcho"
DB_USER="honcho"
BACKUP_DIR="/backups"
DATE=$(date +%Y%m%d_%H%M%S)

# Create backup
pg_dump -h $DB_HOST -U $DB_USER -d $DB_NAME \
  --no-password --verbose \
  -f "$BACKUP_DIR/honcho_backup_$DATE.sql"

# Compress backup
gzip "$BACKUP_DIR/honcho_backup_$DATE.sql"

# Clean old backups (keep last 7 days)
find $BACKUP_DIR -name "honcho_backup_*.sql.gz" -mtime +7 -delete

echo "Backup completed: honcho_backup_$DATE.sql.gz"
```

### Log Management

**Centralized Logging:**
```yaml
# fluentd-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-config
data:
  fluent.conf: |
    <source>
      @type tail
      path /var/log/containers/honcho-*.log
      pos_file /var/log/fluentd-honcho.log.pos
      tag kubernetes.honcho
      format json
    </source>
    
    <match kubernetes.honcho>
      @type elasticsearch
      host elasticsearch.monitoring.svc.cluster.local
      port 9200
      index_name honcho-logs
    </match>
```

### Performance Monitoring

**Prometheus Configuration:**
```yaml
# prometheus-config.yaml
global:
  scrape_interval: 15s

scrape_configs:
- job_name: 'honcho-api'
  static_configs:
  - targets: ['honcho-api:8000']
  metrics_path: /metrics
  scrape_interval: 30s

- job_name: 'postgres'
  static_configs:
  - targets: ['postgres-exporter:9187']
```

This deployment guide provides comprehensive coverage for production deployments. Choose the approach that best fits your infrastructure and scaling requirements.
