# ATOMIC PROPOSITION EXTRACTION

## OBJECTIVE
Extract ALL atomic propositions (both explicit and implicit) from the peer's latest message. An atomic proposition is a single, independently verifiable statement with sufficient context to be meaningful standalone.

## CORE DEFINITION: ATOMIC PROPOSITION

An atomic proposition MUST satisfy ALL three criteria:

1. **SINGLE TRUTH VALUE**: Evaluable as true/false independently of other statements
2. **NO LOGICAL CONNECTIVES**: Contains no AND, OR, IF-THEN, UNLESS, BECAUSE, etc.
3. **SUFFICIENT CONTEXT**: Meaningful without referencing other propositions

### Context Sufficiency Requirements
Each proposition must include:
- **Subject specificity**: Full names, not pronouns (use peer name from peer card)
- **Object specificity**: Concrete nouns with disambiguating details
- **Temporal specificity**: Absolute dates (YYYY-MM-DD format), not relative references
- **Semantic completeness**: All information needed to understand the claim

**Current context:**
- Current date/time: {message_created_at}
- Peer name: {peer_name}

### Correct vs. Incorrect Atomicity

❌ **INSUFFICIENT CONTEXT** (under-specified):
- "Maria is happy" → Missing: happy about what?
- "He said hi" → Missing: who is "he"? To whom?
- "She went there yesterday" → Missing: who? where? exact date?
- "The interview went well" → Missing: whose interview? which interview?

❌ **COMPOUND STATEMENTS** (multiple truth values):
- "Maria is happy and relieved about her promotion" → 2 propositions
- "James lives in NYC and works remotely" → 2 propositions  
- "If it rains, I'll stay home" → 2 propositions (conditional)
- "Sarah went to the store because she needed milk" → 2 propositions

✓ **PROPERLY ATOMIC**:
- "Maria is happy about her job promotion at Google"
- "James said hi to his neighbor this morning"
- "Sarah went to the grocery store on 2025-06-26"
- "The interview for the pharmacy position went well for Ann"

---

## EXTRACTION ALGORITHM

### PHASE 1: EXPLICIT EXTRACTION

**Process each sentence in the peer's message:**

1. **Identify all factual claims** - What is directly stated?
2. **Decompose compounds** - Split statements with logical connectives:
   - "A and B" → Extract A, Extract B
   - "A or B" → Extract A, Extract B (both possibilities stated)
   - "If A then B" → Extract A (as conditional), Extract B (as conditional)
   - "A because B" → Extract A, Extract B
3. **Contextualize** - Add all necessary context from:
   - Conversation history (for pronoun/reference resolution)
   - Temporal context (convert relative → absolute dates)
   - Peer card (for consistent naming)
4. **Verify atomicity** - Check each extracted proposition against core definition

**Explicit extraction includes:**
- Direct factual statements
- Descriptions and characterizations
- Stated preferences, feelings, and opinions
- Reported events and actions
- Stated relationships and connections
- Negations (what is explicitly denied)

### PHASE 2: IMPLICIT EXTRACTION

**For each explicit proposition, identify certain implications:**

Only extract implications that are **logically necessary** or **definitionally true**. Do NOT extract:
- Speculations or possibilities
- Cultural assumptions
- Probabilistic inferences
- Subjective interpretations

**Categories of valid implicit extraction:**

1. **Definitional implications:**
   - "I graduated from MIT" → "Anthony attended MIT"
   - "My daughter starts school" → "Carlos has a daughter"
   - "I'm taking my dog to the vet" → "Sarah has a dog"

2. **Temporal/mathematical implications:**
   - "I'm 25 years old" + current date → Calculate birth year
   - "My 10th birthday" + current date → Calculate current age
   - "Next month" → Calculate absolute date

3. **Relational implications:**
   - "My spouse loves hiking" → "Marcus has a spouse"
   - "I called my brother" → "Anna has a brother"

4. **Possessive/locational implications:**
   - "I painted my house" → "James has a house"
   - "I left my keys at home" → "Sarah has keys" + "Sarah has a home"

5. **Role/status implications:**
   - "I graduated from law school" → "Michelle attended law school"
   - "My company promoted me" → "Alex is employed" + "Alex works for a company"

**Do NOT extract:**
- Future possibilities ("might," "could," "planning to")
- Uncertain states ("probably," "maybe")
- Conditional outcomes that didn't occur
- Motivations or reasons (unless explicitly stated)
- Emotional interpretations beyond what's stated

---

## SYSTEMATIC EXTRACTION CHECKLIST

For exhaustive extraction, verify you've processed:

### Content Elements
- [ ] Every independent clause extracted
- [ ] All compound statements decomposed
- [ ] All pronouns resolved to peer name
- [ ] All relative temporal references converted to absolute dates
- [ ] All possessive relationships extracted (both item and possession)
- [ ] All relational terms extracted (family, work, social)
- [ ] All locations/places contextualized
- [ ] All negations captured
- [ ] All quantitative information (ages, counts, measurements)

### Implicit Derivations
- [ ] Family relationships implied by possessives ("my daughter" → has daughter)
- [ ] Possessions implied by actions ("walked my dog" → has dog)
- [ ] Locations implied by actions ("went home" → has home)
- [ ] Past states implied by transitions ("graduated" → attended)
- [ ] Age/birth year calculated from age statements
- [ ] Employment implied by role references
- [ ] Skill/knowledge implied by actions ("I coded" → knows programming)

### Quality Checks
- [ ] Each proposition starts with peer name
- [ ] Each proposition has exactly ONE truth value
- [ ] Each proposition is self-contained (understandable without others)
- [ ] No logical connectives remain in any proposition
- [ ] Sufficient disambiguating context in each proposition
- [ ] No redundant or duplicate propositions

---

## CONTEXT SOURCES (Priority Order)

1. **Latest peer message** (PRIMARY - required)
2. **Conversation history** (for resolving references and pronouns)
3. **Peer card** (for consistent naming and existing facts)
4. **Working representation** (for additional context if needed)
5. **Current timestamp** ({message_created_at}) for temporal calculations

---

## EDGE CASES & SPECIAL HANDLING

### Temporal References
- "yesterday" → Calculate exact date from {message_created_at}
- "next month" → Calculate month and year
- "last Saturday" → Calculate exact date
- "when I was 10" → Do NOT extract as current fact; requires past tense: "Anthony was 10 years old in [year]"

### Negations
- "I don't have a car" → "Anthony does not have a car"
- Include negations as atomic propositions (they have truth values)

### Conditional Statements
- "If it rains tomorrow, I'll cancel" → Extract both possibilities with conditional context
  - "Anthony will cancel [activity] if it rains on [date]"
  - DO NOT extract as definite future: "Anthony will cancel"

### Modal Statements (Uncertainty)
- "I might go to the party" → "Anthony is considering going to the party"
- "I should study more" → "Anthony believes they should study more"
- Preserve the modal/epistemic status

### Questions and Plans
- Future plans: "I'm planning to visit Japan" → "Anthony is planning to visit Japan"
- NOT: "Anthony will visit Japan" (removes intentionality)

### Comparatives and Superlatives
- "I'm taller than my brother" → "Anthony is taller than Anthony's brother"
- Requires relationship context to be meaningful

---

## INPUT DATA

{{ peer_card_section }}

{{ working_representation_section }}

### Recent conversation history:
<history>
{{ history }}
</history>

### New message to analyze:
<new_turns>
{{ new_turns_section }}
</new_turns>

---

## OUTPUT FORMAT

Return a JSON object with exactly two keys: "explicit" and "implicit". Each must be an array of strings (propositions). Do not include any other keys or structure.
```json
{
    "explicit": [
        "proposition 1",
        "proposition 2"
    ],
    "implicit": [
        "proposition 1",
        "proposition 2"
    ]
}
```

**Before outputting:**
1. Review the peer's message sentence by sentence
2. Apply the extraction algorithm systematically
3. Use the checklist to ensure exhaustive coverage
4. Verify each proposition meets the three core criteria
5. Ensure proper JSON formatting

Extract ALL atomic propositions now.